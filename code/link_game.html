<!DOCTYPE html>
<meta charset="utf-8">
<style>

circle {
  stroke-width: 1.5px;
}

line {
  stroke: #999;
}

</style>
<body>
<script src="d3.js"></script>
<script>


            perso_war = { "id": "perso_war", "name": "Guerrier", "group": 1}
            perso_mag = { "id": "perso_mag", "name": "Mage", "group": 1}
            obj_longsword = { "id": "obj_longsword", "name": "Épée longue", "group": 1}
            obj_mage_scroll = { "id": "obj_mage_scroll", "name": "Sorts de mage", "group": 1}


    function init_force_layout(one_more_link) {


        graph_init = {
          "nodes": [
            perso_war,
            perso_mag,
            obj_longsword,
            obj_mage_scroll,
          ],
          "links": [
            {"source": perso_war, "target": obj_longsword, "value": 4},
            //{"source": perso_mag, "target": obj_mage_scroll, "value": 1},
          ]
        }

          graph = graph_init;

          if (one_more_link == true) {
            graph["links"].push({source: perso_mag, target: obj_mage_scroll, value: 1});
          }

        //graph["links"].push({source: perso_mag, target: obj_mage_scroll, value: 1});

        // inspirations :
        // Labeled Force Layout https://bl.ocks.org/mbostock/950642
        // Bounded Force Layout https://bl.ocks.org/mbostock/1129492
        // Modifying a Force Layout https://bl.ocks.org/mbostock/1095795

        var width = 960,
            height = 500,
            radius = 6;

        var fill = d3.scale.category20();

        var force = d3.layout.force()
            .gravity(.05)
            .charge(-240)
            .linkDistance(50)
            .size([width, height]);

        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        //d3.json("graph.json", function(error, graph) {
          //if (error) throw error;

          var link = svg.selectAll("line")
              .data(graph.links)
            .enter().append("line");

          node = svg.selectAll("circle")
              .data(graph.nodes)
            //.enter().append("circle")
            .enter().append("g")
              //.attr("r", radius - .75)
              //.style("fill", function(d) { return fill(d.group); })
              //.style("stroke", function(d) { return d3.rgb(fill(d.group)).darker(); })
              //.attr("name", "pouet")
              .attr("name", function(d) { return d.name; })
              .call(force.drag);

          node.append("image")
              .attr("xlink:href", "silver_key.png")
              .attr("x", -8)
              .attr("y", -8)
              .attr("width", 16)
              .attr("height", 16);

          node.append("text")
              .attr("dx", 12)
              .attr("dy", ".35em")
              //.text("blorp");
              .text(function(d) { return d.name; });

          force
              .nodes(graph.nodes)
              .links(graph.links)
              .on("tick", tick)
              .start();

 //vis.selectAll("circle.node").on("click", function(){
node.on("click", function(){
    console.log("click sur un node");
    console.log(d3.select(this).attr('r'));
    console.log(d3.select(this).attr('name'));
            //d3.select(this).attr('r', 25)
            //    .style("fill","lightcoral")
            //    .style("stroke","red");
            //graph.links.push({source: perso_mag, target: obj_mage_scroll});
        });


    }



//d3.select("svg").remove()


/*
    perso_war = { "id": "perso_war", "name": "Guerrier", "group": 1},
    perso_mag = { "id": "perso_mag", "name": "Mage", "group": 1},
    obj_longsword = { "id": "obj_longsword", "name": "Épée longue", "group": 1},
    obj_mage_scroll = { "id": "obj_mage_scroll", "name": "Sorts de mage", "group": 1},
*/

/*
graph_init = {
  "nodes": [
    perso_war,
    perso_mag,
    obj_longsword,
    obj_mage_scroll,
  ],
  "links": [
    {"source": perso_war, "target": obj_longsword, "value": 4},
    //{"source": perso_mag, "target": obj_mage_scroll, "value": 1},
  ]
}

  graph = graph_init;

graph["links"].push({source: perso_mag, target: obj_mage_scroll, value: 1});


var width = 960,
    height = 500,
    radius = 6;

var fill = d3.scale.category20();

var force = d3.layout.force()
    .gravity(.05)
    .charge(-240)
    .linkDistance(50)
    .size([width, height]);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

//d3.json("graph.json", function(error, graph) {
  //if (error) throw error;

  var link = svg.selectAll("line")
      .data(graph.links)
    .enter().append("line");

  var node = svg.selectAll("circle")
      .data(graph.nodes)
    //.enter().append("circle")
    .enter().append("g")
      //.attr("r", radius - .75)
      //.style("fill", function(d) { return fill(d.group); })
      //.style("stroke", function(d) { return d3.rgb(fill(d.group)).darker(); })
      //.attr("name", "pouet")
      .attr("name", function(d) { return d.name; })
      .call(force.drag);

  node.append("image")
      .attr("xlink:href", "silver_key.png")
      .attr("x", -8)
      .attr("y", -8)
      .attr("width", 16)
      .attr("height", 16);

  node.append("text")
      .attr("dx", 12)
      .attr("dy", ".35em")
      //.text("blorp");
      .text(function(d) { return d.name; });

  force
      .nodes(graph.nodes)
      .links(graph.links)
      .on("tick", tick)
      .start();
*/


  function tick() {
    node.attr("cx", function(d) { return d.x = Math.max(radius, Math.min(width - radius, d.x)); })
        .attr("cy", function(d) { return d.y = Math.max(radius, Math.min(height - radius, d.y)); });

    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

  }


/*
 //vis.selectAll("circle.node").on("click", function(){
node.on("click", function(){
    console.log("click sur un node");
    console.log(d3.select(this).attr('r'));
    console.log(d3.select(this).attr('name'));
            //d3.select(this).attr('r', 25)
            //    .style("fill","lightcoral")
            //    .style("stroke","red");
            //graph.links.push({source: perso_mag, target: obj_mage_scroll});
        });
*/
//});

init_force_layout(true);

</script>
